steps:
- name: 'ubuntu'
  entrypoint: 'bash'
  args:
  - '-c'
  - |
    # Install GitHub CLI
    apt-get update
    apt-get install -y git gh

   
    echo ${_GH_TOKEN} + "here"

    echo $_GH_TOKEN + "here 2"
   
    # Configure Git with the GitHub App token
    git config --global url."https://x-access-token:${_GH_TOKEN}@github.com".insteadOf "https://github.com"
    git config --global user.email "cloud-build@example.com"
    git config --global user.name "Cloud Build"

    # Create a new file to simulate a change
    echo "Build from $(date)" > build_log.txt
    
    # Create a new branch
    git checkout -b cloud-build-update
    
    # Stage and commit the changes
    git add .
    git commit -m "Automated changes from Cloud Build"
    
    # Push the new branch to the remote repository
    git push -u origin cloud-build-update

    # Create the pull request using the GitHub CLI
    gh pr create --title "Automated PR from Cloud Build" --body "This PR was created automatically by Cloud Build."
  secretEnv: ['_GH_TOKEN'] 
options:
  logging: CLOUD_LOGGING_ONLY

availableSecrets:
  secretManager:
    - versionName: projects/626163762206/secrets/lauras_repo-github-oauthtoken-82060a/versions/latest
      env: '_GH_TOKEN'
